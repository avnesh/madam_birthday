<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wishes - Madam</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen font-poppins">
<nav class="p-4 container mx-auto flex justify-between items-center">
<a href="index.html" class="text-sm">Home</a>
<div class="nav-links space-x-4">
<a href="memories.html">Memories</a>
<a href="funzone.html">Fun Zone</a>
<a href="surprise.html">Surprise</a>
</div>
</nav>

<main class="container mx-auto p-6 text-center">
  <h2 class="script-heading text-5xl mb-8">Dear Madam,</h2>
  <div class="mt-6 max-w-3xl mx-auto rounded-xl shadow-lg p-6 fade-in-up typed-message-container">
    <div id="typed" class="text-xl leading-relaxed"></div>
  </div>
  
  <h3 class="script-heading text-3xl mt-16">Choose Your Melody 🎶</h3>
  <div class="mt-6 max-w-lg mx-auto p-6 rounded-xl shadow-lg typed-message-container playlist-container">
      <div class="playlist-scroll">
        <div id="playlistList" class="space-y-2"></div>
      </div>
  </div>

  <div class="mt-16" style="position: relative; z-index: 100;">
    <a href="funzone.html" onclick="stopMusicAndNavigate('funzone.html'); return false;" class="btn-primary">Next Page: Fun Zone</a>
  </div>
</main>

<footer class="fixed bottom-6 left-1/2 transform -translate-x-1/2" style="z-index: 1000;">
  <div id="player" class="player">
    <button id="prevTrack" aria-label="Previous" class="btn-secondary">⏮</button>
    <button id="playToggle" aria-label="Play/Pause" class="btn-primary">▶</button>
    <button id="nextTrack" aria-label="Next" class="btn-secondary">⏭</button>
    <span id="trackName">Loading...</span>
  </div>
</footer>

<audio id="bgAudio"></audio>

<script src="script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
<script>
// Typed.js initialization
const typed = new Typed('#typed', {
  strings: [
    "Your guidance lights our path, and your smile brightens our days.",
    "May your birthday be as graceful and lovely as you are.",
    "Wishing you laughter, love, and a year of beautiful memories."
  ],
  typeSpeed: 35,
  backSpeed: 10,
  backDelay: 2000,
  loop: true,
  showCursor: true,
  cursorChar: '|'
});

// Music Player with hardcoded playlist
const musicPlayer = {
  // CORRECTED PLAYLIST with actual file names
  playlist: [
    { title: "Tum Ho Toh (Original)", file: "birthday.mp3" },
    { title: "Humsafar Saiyaara", file: "Humsafar Saiyaara 128 Kbps.mp3" },
    { title: "Title Track Saiyaara", file: "Title Track Saiyaara 128 Kbps.mp3" }
  ],
  currentIndex: 0,
  audio: document.getElementById('bgAudio'),
  trackName: document.getElementById('trackName'),
  playBtn: document.getElementById('playToggle'),
  prevBtn: document.getElementById('prevTrack'),
  nextBtn: document.getElementById('nextTrack'),
  playlistList: document.getElementById('playlistList'),

  loadTrack(index, autoPlay = true) {
    if(index < 0 || index >= this.playlist.length) return;
    this.currentIndex = index;
    const item = this.playlist[this.currentIndex];
    
    this.audio.src = 'assets/music/' + item.file;
    
    if(autoPlay) {
      // Add a small delay to ensure audio is loaded
      setTimeout(() => {
        this.audio.play().catch(() => {
          console.log('Autoplay prevented - user interaction required');
          this.playBtn.innerHTML = '▶';
        });
      }, 100);
    }
    
    this.trackName.textContent = item.title;
    this.updatePlaylistUI();
  },

  play() { 
    this.audio.play().catch(() => console.log('Play prevented'));
    this.playBtn.innerHTML = '⏸';
  },

  pause() { 
    this.audio.pause();
    this.playBtn.innerHTML = '▶';
  },

  updatePlaylistUI() {
    const isPlaying = !this.audio.paused;
    
    this.playlistList.innerHTML = '';
    this.playlist.forEach((item, index) => {
      const div = document.createElement('div');
      const isActive = index === this.currentIndex;
      
      let classList = 'playlist-item';
      if(isActive) classList += ' active';

      div.className = classList;
      
      let icon = (isActive && isPlaying) ? '🎵' : '🎶';
      
      div.innerHTML = `<span class="play-icon">${icon}</span>${item.title}`;
      
      div.onclick = () => {
        if(index === this.currentIndex) {
          this.audio.paused ? this.play() : this.pause();
        } else {
          this.loadTrack(index);
        }
      };
      this.playlistList.appendChild(div);
    });
  },

  bindEvents() {
    this.playBtn.addEventListener('click', () => { 
      this.audio.paused ? this.play() : this.pause();
    });
    
    this.prevBtn.addEventListener('click', () => {
      this.loadTrack((this.currentIndex - 1 + this.playlist.length) % this.playlist.length);
    });
    
    this.nextBtn.addEventListener('click', () => {
      this.loadTrack((this.currentIndex + 1) % this.playlist.length);
    });

    this.audio.addEventListener('ended', () => {
      this.loadTrack((this.currentIndex + 1) % this.playlist.length);
    });

    this.audio.addEventListener('play', () => {
      this.playBtn.innerHTML = '⏸';
      this.updatePlaylistUI();
    });
    
    this.audio.addEventListener('pause', () => {
      this.playBtn.innerHTML = '▶';
      this.updatePlaylistUI();
    });
  },
  
  init() {
    this.loadTrack(0, true); // Enable auto-play on page load
    this.bindEvents();
    
    // Stop music when user navigates away from the page
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        this.pause();
      }
    });
    
    // Stop music before page unload
    window.addEventListener('beforeunload', () => {
      this.pause();
    });
  }
};

// Function to stop music and navigate (specific to wishes.html)
function stopMusicAndNavigate(nextUrl) {
  if(typeof musicPlayer !== 'undefined' && musicPlayer.audio) {
    musicPlayer.audio.pause();
    musicPlayer.audio.currentTime = 0;
  }
  location.href = nextUrl;
}

document.addEventListener('DOMContentLoaded', () => {
  musicPlayer.init();
  
  // Fallback: If autoplay is blocked, start music on first user interaction
  let musicStarted = false;
  const startMusicOnInteraction = () => {
    if (!musicStarted && musicPlayer.audio.paused) {
      musicPlayer.play();
      musicStarted = true;
    }
  };
  
  // Listen for any user interaction to start music
  document.addEventListener('click', startMusicOnInteraction, { once: true });
  document.addEventListener('keydown', startMusicOnInteraction, { once: true });
  document.addEventListener('touchstart', startMusicOnInteraction, { once: true });
});
</script>
</body>
</html>